#include <stdarg.h>#include "prolog.h"static term _history;static voidpush_history(term x){	add_clause(new_unit(h_fn1(_history, x)), TRUE);}voidhistory_frame(char *isa, ...){	va_list ap;	char *slot_name;	term frame_name = gensym(isa);        make_slot(frame_name, "isa", hcons(intern(isa), _nil));	va_start(ap, isa);	while ((slot_name = va_arg(ap, char *)))	{		term slot_value = va_arg(ap, term);		make_slot(frame_name, slot_name, slot_value);	}	va_end(ap);	push_history(frame_name);}static termlast_run(void){	term p = PROC(_history);	if (p == NULL)		fail("There is no history");	return(ARG(1, HEAD(p)));}static intshow(term goal, term *frame){	term slot = check_arg(1, goal, frame, ATOM, IN);	term val = slot_value(last_run(), slot);	if (val == NULL)		fail("Can't find this property of current rule");	list_proc(val);	fputc('\n', output);	return(TRUE);}static intpop_history(void){	term p = PROC(_history);	if (p == NULL)		fail("There is no history");	remove_frame(p);	PROC(_history) = NEXT(p);	free_term(p);	return(TRUE);}voidhistory_init(void){	_history = intern("exploration_history");	new_subr(last_run, "last");	defop(700, FX, new_pred(show, "show"));	new_pred(pop_history, "pop");}